- name: CentOS 7 Zabbix-agent install
  hosts: all
  tasks:
    - name: Zabbix Repository Keys
      copy:
      src: http://repo.zabbix.com/RPM-GPG-KEY-ZABBIX-A14FE591
      dest: RPM-GPG-KEY-ZABBIX-A14FE591
      owner: root
      group: root
      mode: u=rw,g=r,o=r
    - name: Zabbix Repository
      yum_repository:
        name: zabbix
        description: Zabbix Official Repository - $basearch
        baseurl: http://repo.zabbix.com/zabbix/3.4/rhel/{{ distribution_major_version | default(ansible_distribution_major_version) }}/$basearch/
        gpgkey: http://repo.zabbix.com/RPM-GPG-KEY-ZABBIX-A14FE591
    - name: Installs Zabbix-agent
      yum: pkg=zabbix-agent
